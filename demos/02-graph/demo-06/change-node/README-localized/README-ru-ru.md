---
page_type: sample 
products:
- ms-graph
languages:
- nodejs
- javascript
description: "Создайте подписки Microsoft Graph webhook для приложения Node.js, чтобы оно могло получать уведомления об изменениях в данных учетной записи пользователя Microsoft"
extensions:
  contentType: samples
  technologies:
  - Microsoft Graph
  createdDate: 3/9/2016 4:12:18 PM
---
# Пример Microsoft Graph Webhooks для Node.js

[![Состояние сборки](https://travis-ci.org/microsoftgraph/nodejs-webhooks-rest-sample.svg)](https://travis-ci.org/microsoftgraph/nodejs-webhooks-rest-sample)

## Содержание ##
* [Введение](#introduction)

* [Снимки экрана](#screenshots)

* [Предварительные требования](#prerequisites)

* [Регистрация приложения](#Register-the-app)

* [Настройка туннеля для вашего localhost](#Configure-a-tunnel-for-your-localhost)

* [Настройка и запуск веб-приложения](#Configure-and-run-the-web-app)

* [Участие](#contributing)

* [Вопросы и примечания](#Questions-and-Comments)

* [Дополнительные ресурсы](#Additional-resources)


## Введение
<a name="introduction"></a>

В этом примере Node.js показано, как начать получать уведомления от Microsoft Graph. Ниже приведены типичные задачи, которые веб-приложение выполняет с веб-заездами Microsoft Graph.

- Войдите в систему, используя учетную запись своей работы или школы, чтобы получить токен доступа.
- Используйте токен доступа для создания подписки на webhook.
- Возврат маркера проверки для подтверждения URL-адреса уведомления.
- Слушайте уведомления от Microsoft Graph.
- Запросите дополнительную информацию в Microsoft Office 365, используя данные в уведомлении.

## Снимки экрана
<a name="screenshots"></a>

1. Сначала вам нужно войти.

    ![войти](https://user-images.githubusercontent.com/3375461/31968683-c373ad30-b8c6-11e7-9d01-413fab9fd6d5.png)

1. После входа приложение будет прослушивать входящие электронные письма.

    ![listening](https://user-images.githubusercontent.com/3375461/31968718-e19696c4-b8c6-11e7-91f2-f1806be0b134.png)

1. После отправки электронного письма на адрес, вы увидите его в приложении.

    ![email](https://user-images.githubusercontent.com/3375461/31968754-0ce4dafc-b8c7-11e7-8458-8152d598228e.png)

## Предварительные требования
<a name="prerequisites"></a>

Чтобы использовать пример Webhook, вам необходимо следующее:

- [Node.js](https://nodejs.org/) (версия 4\. или 5)
- [Рабочая или учебная учетная запись](http://dev.office.com/devprogram)

## Регистрация приложения
<a name="Register-the-app"></a>

Это приложение использует конечную точку Azure AD, поэтому вы зарегистрируете ее на [портале Azure](https://ms.portal.azure.com/#blade/Microsoft_AAD_IAM/ApplicationsListBlade).

1. Войдите на портал Azure, используя рабочую или учебную учетную запись или личную учетную запись Microsoft.
1. Если ваша учетная запись предоставляет вам доступ более чем к одному арендатору, выберите свою учетную запись в верхнем правом углу и установите для сеанса портала нужный клиент Azure AD (с помощью Switch Directory).
1. В левой области навигации выберите службу **Azure Active Directory**, а затем выберите **Регистрация приложений**
![](readme-images/registrations.png)

1. Выберите **Регистрация нового приложения**.

    1. Введите понятное имя для приложения.
    1. Выберите «Веб-приложение / API» в качестве **Типа приложения**.
    1. Введите`http://localhost:3000/callback` для **URL входа**.
    1. В разделе Поддерживаемые типы учетных записей выберите Учетные записи в любом организационном каталоге и личные учетные записи Microsoft (например, Skype, Xbox, Outlook.com).
    1. Нажмите **Создать**.

1. Выберите новое приложение из списка зарегистрированных приложений.На странице **Обзор** приложения найдите значение **Идентификатор приложения (клиент)** и запишите его, чтобы использовать его позже.
Это необходимо для того, чтобы настроить файл конфигурации Visual Studio для этого проекта.
![](readme-images/client.png)
1. Настройте разрешения для приложения:

    1. Выберите **параметры ** > **необходимые разрешения** > **добавить**.
    1. Выберите **выбрать API** > **Microsoft Graph**и щелкните **выберите**.
    1. Выберите **выбрать разрешения**, прокрутите страницу вниз до раздела **делегированные разрешения**, выберите **почта. Прочтите**и щелкните **выберите**.
    1. Нажмите кнопку **Готово**.
	![](readme-images/permissions.png)

1. Выберите **Сертификаты и секреты** в разделе **Управление**. Нажмите кнопку **Новый секрет клиента**. Введите значение в поле «Описание», выберите один из параметров «Срок действия» и нажмите **Добавить**.

![](readme-images/secrets.png)

1. **Важно!** Скопируйте значение ключа - это секрет вашего приложения. Вы не сможете получить доступ к этому значению снова после того, как покинете этот блейд.

Вы будете использовать **идентификатор приложения** и **секрет** для настройки приложения.

## Настройте туннель для вашего localhost

В примере на сервере разработки используется localhost. По этой причине нам нужен туннель, который может пересылать запросы с URL-адреса в Интернете на ваш локальный хост. Если по какой-либо причине вы не хотите использовать туннель, см. [Хостинг без туннеля](https://github.com/OfficeDev/Microsoft-Graph-Nodejs-Webhooks/wiki/Hosting-the-sample-without-a-tunnel). Если вам нужно подробное объяснение того, зачем использовать туннель, см. [Почему я должен использовать туннель?](https://github.com/OfficeDev/Microsoft-Graph-Nodejs-Webhooks/wiki/Why-do-I-have-to-use-a-tunnel)

Для этого примера мы используем [ngrok](https://ngrok.com/) для создания туннеля. Чтобы настроить ngrok:

1. [скачать](https://ngrok.com/download) и распаковать ngrok двоичные файлы.
1. Введите следующую команду:

    ```Shell
    ngrok http 3000
    ```

1. Обратите внимание на *общедоступный URL-адрес* https, который вам предоставляет ngrok. Это пример:

    ```http
    https://{NGROK_ID}.ngrok.io
    ```

Вам понадобится значение `NGROK_ID` в следующем разделе.

## Настройка и запуск веб-приложения

1. Откройте `constants.js`, используя текстовый редактор.
1. Замените `ENTER_YOUR_CLIENT_ID` на идентификатор клиента для зарегистрированного в Azure приложения.
1. Замените `ENTER_YOUR_SECRET` на секрет клиента для зарегистрированного в Azure приложения.
1. Замените `NGROK_ID` значение в *общедоступный URL-адрес HTTPS, который* из предыдущего раздела.
![](const)
1. Установите зависимости, выполнив следующую команду:

    ```Shell
    npm install
    ```

1. Запустите приложение, выполнив следующую команду:

    ```Shell
    npm start
    ```
    > **Примечание.** Вы также можете заставить приложение ждать отладчик. Чтобы дождаться отладчика, используйте следующую команду:
    >
    > ```Shell
    > npm run debug
    > ```
    > можно также вложить отладчик, который входит в код Microsoft Visual Studio. Дополнительные сведения см. в статье [Отладка в Visual Studio Code](https://code.visualstudio.com/Docs/editor/debugging).

1. Откройте браузер и перейдите в [http://localhost:3000](http://localhost:3000).

## Участие

Если вы хотите добавить код в этот пример, просмотрите статью [CONTRIBUTING.MD](/CONTRIBUTING.md).

Этот проект соответствует [Правилам поведения разработчиков открытого кода Майкрософт](https://opensource.microsoft.com/codeofconduct/). Дополнительные сведения см. в разделе [часто задаваемых вопросов о правилах поведения](https://opensource.microsoft.com/codeofconduct/faq/). Если у вас возникли вопросы или замечания, напишите нам по адресу [opencode@microsoft.com](mailto:opencode@microsoft.com).

## Вопросы и комментарии

Мы хотели бы получить ваши отзывы о образце Microsoft Graph Webhook. Вы можете отправлять нам вопросы и предложения в разделе [Проблемы](https://github.com/OfficeDev/Microsoft-Graph-NodeJs-Webhooks/issues) этого репозитория.

Вопросы, связанные с разработкой Office 365 Разместите их в [Stack Overflow](http://stackoverflow.com/questions/tagged/Office365+API). Обязательно пометьте свои вопросы или комментарии с помощью \[Office365] и \[API].

## Дополнительные ресурсы

- [Обзор Microsoft Graph](http://graph.microsoft.io/)
- [Подписная справочная документация](https://graph.microsoft.io/en-us/docs/api-reference/beta/resources/subscription)

## Авторские права

(c) Корпорация Майкрософт (Microsoft Corporation), 2019. Все права защищены.
